<!DOCTYPE html>
<% if current_user %>
  <%= current_user.email %>
<% end %>
<html>
    <head>
        <title>Courses List</title>
        <meta name="instructorCoursesListView" content="width=device-width,initial-scale=1">
        <%= csrf_meta_tags %>
        <%= csp_meta_tag %>
        <script type="text/javascript">
            function getCellValue(row, idx) {
                return $(row).children('td').eq(idx).text()
            }

            function compare(idx) {
                return function(val1, val2) {
                    let firstVal = getCellValue(val1, idx)
                    let secondVal = getCellValue(val2, idx)
                    return $.isNumeric(firstVal) && $.isNumeric(secondVal) ? firstVal - secondVal : firstVal.localeCompare(secondVal)
                }
            }

            $(document).ready(function() {
                $('#coursesTable th').click(function() {
                    let table = $(this).parents('table').eq(0)
                    let rows = table.find('tr:gt(0)').toArray().sort(compare($(this).index()))
                    this.asc = !this.asc

                    if (!this.asc) {
                        rows = rows.reverse()
                    }

                    for (let i = 0; i < rows.length; i++) {
                        table.append(rows[i])
                    }
                })
            })

            $(document).ready(function() {
                $('#searchBox').on('keyup', function() {
                var value = $(this).val().toLowerCase()
                $('#coursesTable tr').filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            })
        </script>
    </head>

    <body>
        <h1>Courses List</h1>
        <input type="text" id="searchBox" placeholder="Search...">
        <table id="coursesTable">
            <thread>
                <tr>
                    <th>Course Number</th> <th>Course Name</th> <th>Term</th> <th>Campus</th> <th>Actions</th>
                </tr>
            </thread>
            <tbody>
                <% @courses.each do |course| %>
                    <tr>
                        <td><%= course.number %></td>
                        <td><%= course.name %></td>
                        <td><%= course.term %></td>
                        <td><%= course.campus %></td>
                        <td><%= link_to 'Show', course %></td>
                    </tr>
                <% end %>
            </tbody>
        </table>
    </body>
</html>