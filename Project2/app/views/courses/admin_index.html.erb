<!DOCTYPE html>
<% if current_user %>
  <%= current_user.email %>
<% end %>
<html>
    <head>
        <title>Courses List</title>
        <meta name="AdminCoursesListView" content="width=device-width,initial-scale=1">
        <%= csrf_meta_tags %>
        <%= csp_meta_tag %>
        <style> # Added just for testing purpose, you can remove it
            table, th, td {
            border: 1px solid black;
            }
        </style>
        <script type="text/javascript"> # This script give the ability to sort and search in the courses table
            # This function get cell value from specific rown and columns
            function getCellValue(row, idx) {
                return $(row).children('td').eq(idx).text()
            }

            # This function compares two cell values occur in the same column
            function compare(idx) {
                return function(val1, val2) {
                    let firstVal = getCellValue(val1, idx)
                    let secondVal = getCellValue(val2, idx)
                    return $.isNumeric(firstVal) && $.isNumeric(secondVal) ? firstVal - secondVal : firstVal.localeCompare(secondVal)
                }
            }

            # It provides the user the ability to sort the table
            $(document).ready(function() {
                $('#coursesTable th').click(function() {
                    let table = $(this).parents('table').eq(0)
                    let rows = table.find('tr:gt(0)').toArray().sort(compare($(this).index()))
                    this.asc = !this.asc

                    # If the sorting direction is descending, it reverses the rows' order
                    if (!this.asc) {
                        rows = rows.reverse()
                    }

                    # Restores the sorted rows to the table in the new order.
                    for (let i = 0; i < rows.length; i++) {
                        table.append(rows[i])
                    }
                })
            })

            # Gives the table searching ability
            $(document).ready(function() {
                $('#searchBox').on('keyup', function() {
                var value = $(this).val().toLowerCase()
                $('#coursesTable tr').filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            })
        </script>
    </head>

    <body>
        <h1>Courses List</h1>
        <input type="text" id="searchBox" placeholder="Search...">
        <table id="coursesTable"> # The id is used for the script above
            <thread>
                <tr> # Table Header Row
                    <th>Course Number</th> <th>Course Name</th> <th>Term</th> <th>Campus</th> <th>Actions</th> # Header Cells
                </tr>
            </thread>
            <tbody> # Table Body
                <% @courses.each do |course| %>
                    <tr> # Table Body Row
                        # Table Body Cells
                        <td><%= course.number %></td>
                        <td><%= course.name %></td>
                        <td><%= course.term %></td>
                        <td><%= course.campus %></td>
                        <td><%= link_to 'Show', course %></td>
                        <td><%= link_to 'Edit', edit_course_path(course) %></td>
                        <td><%= link_to 'Delete', course, method: :delete { confirm: 'Are you sure?' } %></td>
                        # This provide a parameter value to the course gerenic page so that it show the correct course attributes
                        <%= form_tag '/next_page' do %>
                            <%= hidden_field_tag 'currentCourse', course %>
                            <%= submit_tag 'Submit' %>
                        <% end %>
                    </tr>
                <% end %>
            </tbody>
        </table>
        <br /> <%= link_to 'New Course', new_course_path %>
    </body>
</html>